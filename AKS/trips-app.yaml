apiVersion: v1
kind: Secret
metadata:  
  name: sql-password
type: Opaque
data:
  SQL_PASSWORD: ZkwwcXAzR283
  SQL_SERVER: c3Fsc2VydmVyYmVnNjEwOS5kYXRhYmFzZS53aW5kb3dzLm5ldA==
  SQL_USER: c3FsYWRtaW5iRWc2MTA5
  SQL_DBNAME: bXlkcml2aW5nREI=
---
apiVersion: v1
kind: Service
metadata:
  creationTimestamp: null
  name: tripviewer
spec:
  type: LoadBalancer
  ports:
  - port: 80
    protocol: TCP
    targetPort: 80
  selector:
    run: tripviewer
status:
  loadBalancer: {}
---
apiVersion: v1
kind: Service
metadata:
  name: trips
spec:
  selector:
    app: trips
  ports:
    - name: http
      protocol: TCP
      port: 80
      targetPort: 80
---
apiVersion: v1
kind: Pod
metadata:
  labels:
    app: trips 
  name: trips
spec:
  containers:
  - env:
    - name: OPENAPI_DOCS_URI
      value: http://changeme
    image: registrybeg6109.azurecr.io/trips:v1
    imagePullPolicy: IfNotPresent
    name: trips
    volumeMounts:
      - name: sql-password
        mountPath: "/secrets"
        readOnly: true
    resources:
      limits:
        cpu: 500m
        memory: 250Mi
      requests:
        cpu: 100m
        memory: 50Mi
    ports:
      - containerPort: 80
  volumes:
    - name: sql-password
      secret:
        secretName: sql-password
  dnsPolicy: ClusterFirst
  restartPolicy: Always
---
apiVersion: v1
kind: Pod
metadata:
  labels:
    run: tripviewer 
  name: tripviewer
spec:
  containers:
  - env:
    - name: TRIPS_API_ENDPOINT
      value: http://trips.default.svc.cluster.local
    - name: USERPROFILE_API_ENDPOINT
      value: http://userprofile.default.svc.cluster.local
    image: registrybeg6109.azurecr.io/tripviewer:v1
    imagePullPolicy: IfNotPresent
    name: tripsviewer
    resources:
      limits:
        cpu: 500m
        memory: 250Mi
      requests:
        cpu: 100m
        memory: 50Mi
    ports:
      - containerPort: 80
  dnsPolicy: ClusterFirst
  restartPolicy: Always